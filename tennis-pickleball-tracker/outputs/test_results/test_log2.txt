============================= test session starts =============================
platform win32 -- Python 3.13.3, pytest-9.0.2, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
rootdir: D:\Downloads\cv\tennis-pickleball-tracker
plugins: anyio-3.7.1, langsmith-0.6.6
collecting ... collected 56 items

tests/test_pipeline_video.py::TestVideoLoading::test_video_exists PASSED
tests/test_pipeline_video.py::TestVideoLoading::test_video_opens PASSED
tests/test_pipeline_video.py::TestVideoLoading::test_video_metadata 
  Video: 1920x1080 @ 30.0fps, 1139 frames
PASSED
tests/test_pipeline_video.py::TestVideoLoading::test_read_first_frame PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_import PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_classical_detector_init PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_preprocess 
  White pixel %: 10.73%
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_detect_edges 
  Edge pixel %: 1.75%
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_detect_lines 
  Detected 191 lines
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_full_detect 
  Horizontal lines: 4
  Vertical lines: 4
  Intersections: 16
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_detect_and_compute_homography 
  Homography computation failed (may happen with some videos)
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_transform_point PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_transform_points PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_court_constants PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_import PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_detection_dataclass PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_detect_on_frame 
  YOLO detections: 9
    ball: conf=0.88, bbox=(np.int64(274), np.int64(804), np.int64(448), np.int64(1079))
    ball: conf=0.81, bbox=(np.int64(1187), np.int64(310), np.int64(1285), np.int64(544))
    ball: conf=0.78, bbox=(np.int64(503), np.int64(262), np.int64(559), np.int64(411))
    ball: conf=0.72, bbox=(np.int64(1420), np.int64(253), np.int64(1487), np.int64(411))
    ball: conf=0.71, bbox=(np.int64(1561), np.int64(288), np.int64(1631), np.int64(458))
PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_nms 
  NMS: 3 -> 2 detections
PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_classical_ball_detector 
  Classical ball detections: 4
PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_classical_player_detector_haar 
  Classical player detections (Haar): 6
PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_import PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_track_dataclass PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_init PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_update_with_detection PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_update_without_detection PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_trajectory PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_optical_flow_estimator FAILED
tests/test_pipeline_video.py::TestObjectTracking::test_ball_tracker_combined 
  BallTracker position: (500.0, 300.0)
  After miss: (500.0, 300.0)
PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_import PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_trajectory_point PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_bounce_event PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_trajectory_3d PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_court_projector PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_court_projector_roundtrip PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_physics_model_init PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_in_out_classifier_singles PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_in_out_classifier_with_confidence 
  Near-line: is_in=True, confidence=1.000
  Center: is_in=True, confidence=1.000
PASSED
tests/test_pipeline_video.py::TestInOutClassifierModule::test_import PASSED
tests/test_pipeline_video.py::TestInOutClassifierModule::test_ml_bounce_classifier_init PASSED
tests/test_pipeline_video.py::TestInOutClassifierModule::test_enhanced_system_init PASSED
tests/test_pipeline_video.py::TestVisualization::test_import PASSED
tests/test_pipeline_video.py::TestVisualization::test_frame_annotator_init PASSED
tests/test_pipeline_video.py::TestVisualization::test_draw_detections PASSED
tests/test_pipeline_video.py::TestVisualization::test_draw_ball_trajectory PASSED
tests/test_pipeline_video.py::TestVisualization::test_minimap_tennis 
  MiniMap size: (600, 300, 3)
PASSED
tests/test_pipeline_video.py::TestVisualization::test_minimap_pickleball PASSED
tests/test_pipeline_video.py::TestVisualization::test_heatmap_generator_add_positions 
  Ball heatmap sum: 50.0
PASSED
tests/test_pipeline_video.py::TestVisualization::test_composite_frame_builder 
  Composite frame size: (360, 760, 3)
PASSED
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_import PASSED
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_config PASSED
python : Downloading 
https://github.com/ul
tralytics/assets/rele
ases/download/v0.0.0/
yolov8s.pt to 
'yolov8s.pt'...
At line:1 char:1
+ python -m pytest te
sts/test_pipeline_vid
eo.py -v --tb=short 
-s 2>&1 | ...
+ ~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~
~~~~~~
    + CategoryInfo   
           : NotSpe  
  cified: (Downloa   
 ding htt...'yolo    
v8s.pt'...:Strin    
g) [], RemoteExc    
eption
    + FullyQualified 
   ErrorId : Native  
  CommandError
 

  0%|          | 
0.00/21.5M [00:00<?, 
?B/s]
  2%|2         | 
512k/21.5M 
[00:00<00:04, 
4.49MB/s]
 10%|9         | 
2.12M/21.5M 
[00:00<00:02, 
9.98MB/s]
 23%|##3       | 
5.00M/21.5M 
[00:00<00:01, 
14.7MB/s]
 37%|###6      | 
7.88M/21.5M 
[00:00<00:00, 
19.5MB/s]
 47%|####7     | 
10.1M/21.5M 
[00:00<00:00, 
13.1MB/s]
 63%|######2   | 
13.5M/21.5M 
[00:00<00:00, 
18.0MB/s]
 78%|#######8  | 
16.9M/21.5M 
[00:01<00:00, 
21.0MB/s]
 92%|#########1| 
19.8M/21.5M 
[00:01<00:00, 
23.1MB/s]
100%|##########| 
21.5M/21.5M 
[00:01<00:00, 
18.2MB/s]
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_short_run WARNING: deep-sort-realtime not installed. Falling back to simple IoU-based tracking.

Processing video:   
0%|          | 0/30 
[00:00<?, 
?it/s]Ultralytics 
YOLOv8.0.196  
Python-3.13.3 
torch-2.8.0+cpu 
FAILED
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_100_frames WARNING: deep-sort-realtime not installed. Falling back to simple IoU-based tracking.


Processing video:   
0%|          | 0/100 
[00:00<?, 
?it/s][AUltralytics 
YOLOv8.0.196  
Python-3.13.3 
torch-2.8.0+cpu 
FAILED
tests/test_pipeline_video.py::TestIntegration::test_court_detection_to_classification PASSED

Processing video:   
0%|          | 0/100 
[00:00<?, ?it/s]
tests/test_pipeline_video.py::TestIntegration::test_detection_to_tracking 
  Ball tracked at (361.0, 941.5)
PASSED
tests/test_pipeline_video.py::TestIntegration::test_visualization_with_real_detections 
  Saved annotated frame: D:\Downloads\cv\tennis-pickleball-tracker\outputs\test_results\annotated_frame.jpg

Processing video:   
0%|          | 0/30 
[00:04<?, ?it/s]
PASSED

================================== FAILURES ===================================
_______________ TestObjectTracking.test_optical_flow_estimator ________________
tests\test_pipeline_video.py:380: in test_optical_flow_estimator
    assert vel is None  # no previous frame yet
    ^^^^^^^^^^^^^^^^^^
E   assert (0.0, 0.0) is None
________________ TestEndToEndPipeline.test_pipeline_short_run _________________
tests\test_pipeline_video.py:630: in test_pipeline_short_run
    stats = pipeline.process_video(
src\pipeline.py:288: in process_video
    result = self.process_frame(frame, frame_idx)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\pipeline.py:396: in process_frame
    dets = detector.detect(frame)
           ^^^^^^^^^^^^^^^^^^^^^^
src\object_detection.py:327: in detect
    results = self.model(
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\engine\model.py:101: in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\engine\model.py:235: in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\engine\predictor.py:312: in setup_model
    device=select_device(self.args.device, verbose=verbose),
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\utils\torch_utils.py:119: in select_device
    raise ValueError(f"Invalid CUDA 'device={device}' requested."
E   ValueError: Invalid CUDA 'device=0' requested. Use 'device=cpu' or pass valid CUDA device(s) if available, i.e. 'device=0' or 'device=0,1,2,3' for Multi-GPU.
E   
E   torch.cuda.is_available(): False
E   torch.cuda.device_count(): 0
E   os.environ['CUDA_VISIBLE_DEVICES']: -1
E   See https://pytorch.org/get-started/locally/ for up-to-date torch install instructions if no CUDA devices are seen by torch.
________________ TestEndToEndPipeline.test_pipeline_100_frames ________________
tests\test_pipeline_video.py:668: in test_pipeline_100_frames
    stats = pipeline.process_video(
src\pipeline.py:288: in process_video
    result = self.process_frame(frame, frame_idx)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
src\pipeline.py:396: in process_frame
    dets = detector.detect(frame)
           ^^^^^^^^^^^^^^^^^^^^^^
src\object_detection.py:327: in detect
    results = self.model(
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\engine\model.py:101: in __call__
    return self.predict(source, stream, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\engine\model.py:235: in predict
    self.predictor.setup_model(model=self.model, verbose=is_cli)
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\engine\predictor.py:312: in setup_model
    device=select_device(self.args.device, verbose=verbose),
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\utils\torch_utils.py:119: in select_device
    raise ValueError(f"Invalid CUDA 'device={device}' requested."
E   ValueError: Invalid CUDA 'device=0' requested. Use 'device=cpu' or pass valid CUDA device(s) if available, i.e. 'device=0' or 'device=0,1,2,3' for Multi-GPU.
E   
E   torch.cuda.is_available(): False
E   torch.cuda.device_count(): 0
E   os.environ['CUDA_VISIBLE_DEVICES']: 0
E   See https://pytorch.org/get-started/locally/ for up-to-date torch install instructions if no CUDA devices are seen by torch.
============================== warnings summary ===============================
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
  C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\thop\profile.py:12: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(torch.__version__) < LooseVersion("1.0.0"):

tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
  C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\thop\profile.py:68: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(torch.__version__) >= LooseVersion("1.1.0"):

tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_detect_on_frame
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_short_run
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_100_frames
tests/test_pipeline_video.py::TestIntegration::test_detection_to_tracking
tests/test_pipeline_video.py::TestIntegration::test_visualization_with_real_detections
  C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\nn\tasks.py:567: UserWarning: Environment variable TORCH_FORCE_NO_WEIGHTS_ONLY_LOAD detected, since the`weights_only` argument was not explicitly passed to `torch.load`, forcing weights_only=False.
    return torch.load(file, map_location='cpu'), file  # load

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_pipeline_video.py::TestObjectTracking::test_optical_flow_estimator
FAILED tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_short_run
FAILED tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_100_frames
================= 3 failed, 53 passed, 10 warnings in 20.18s ==================
