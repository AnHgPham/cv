============================= test session starts =============================
platform win32 -- Python 3.13.3, pytest-9.0.2, pluggy-1.6.0 -- C:\Python313\python.exe
cachedir: .pytest_cache
rootdir: D:\Downloads\cv\tennis-pickleball-tracker
plugins: anyio-3.7.1, langsmith-0.6.6
collecting ... collected 56 items

tests/test_pipeline_video.py::TestVideoLoading::test_video_exists PASSED
tests/test_pipeline_video.py::TestVideoLoading::test_video_opens PASSED
tests/test_pipeline_video.py::TestVideoLoading::test_video_metadata 
  Video: 1920x1080 @ 30.0fps, 1139 frames
PASSED
tests/test_pipeline_video.py::TestVideoLoading::test_read_first_frame PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_import PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_classical_detector_init PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_preprocess 
  White pixel %: 10.73%
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_detect_edges 
  Edge pixel %: 1.75%
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_detect_lines 
  Detected 191 lines
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_full_detect 
  Horizontal lines: 4
  Vertical lines: 4
  Intersections: 16
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_detect_and_compute_homography 
  Homography computation failed (may happen with some videos)
PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_transform_point PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_transform_points PASSED
tests/test_pipeline_video.py::TestCourtDetection::test_court_constants PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_import PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_detection_dataclass PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_detect_on_frame 
  YOLO detections: 9
    ball: conf=0.88, bbox=(np.int64(274), np.int64(804), np.int64(448), np.int64(1079))
    ball: conf=0.81, bbox=(np.int64(1187), np.int64(310), np.int64(1285), np.int64(544))
    ball: conf=0.78, bbox=(np.int64(503), np.int64(262), np.int64(559), np.int64(411))
    ball: conf=0.72, bbox=(np.int64(1420), np.int64(253), np.int64(1487), np.int64(411))
    ball: conf=0.71, bbox=(np.int64(1561), np.int64(288), np.int64(1631), np.int64(458))
PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_nms 
  NMS: 3 -> 2 detections
PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_classical_ball_detector 
  Classical ball detections: 4
PASSED
tests/test_pipeline_video.py::TestObjectDetection::test_classical_player_detector_haar 
  Classical player detections (Haar): 6
PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_import PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_track_dataclass PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_init PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_update_with_detection PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_update_without_detection PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_kalman_filter_trajectory PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_optical_flow_estimator 
  First call velocity: (0.0, 0.0)
  Second call velocity: (-0.0308837890625, -0.0613555908203125)
PASSED
tests/test_pipeline_video.py::TestObjectTracking::test_ball_tracker_combined 
  BallTracker position: (500.0, 300.0)
  After miss: (500.0, 300.0)
PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_import PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_trajectory_point PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_bounce_event PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_trajectory_3d PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_court_projector PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_court_projector_roundtrip PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_physics_model_init PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_in_out_classifier_singles PASSED
tests/test_pipeline_video.py::TestTrajectory3D::test_in_out_classifier_with_confidence 
  Near-line: is_in=True, confidence=1.000
  Center: is_in=True, confidence=1.000
PASSED
tests/test_pipeline_video.py::TestInOutClassifierModule::test_import PASSED
tests/test_pipeline_video.py::TestInOutClassifierModule::test_ml_bounce_classifier_init PASSED
tests/test_pipeline_video.py::TestInOutClassifierModule::test_enhanced_system_init PASSED
tests/test_pipeline_video.py::TestVisualization::test_import PASSED
tests/test_pipeline_video.py::TestVisualization::test_frame_annotator_init PASSED
tests/test_pipeline_video.py::TestVisualization::test_draw_detections PASSED
tests/test_pipeline_video.py::TestVisualization::test_draw_ball_trajectory PASSED
tests/test_pipeline_video.py::TestVisualization::test_minimap_tennis 
  MiniMap size: (600, 300, 3)
PASSED
tests/test_pipeline_video.py::TestVisualization::test_minimap_pickleball PASSED
tests/test_pipeline_video.py::TestVisualization::test_heatmap_generator_add_positions 
  Ball heatmap sum: 50.0
PASSED
tests/test_pipeline_video.py::TestVisualization::test_composite_frame_builder 
  Composite frame size: (360, 760, 3)
PASSED
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_import PASSED
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_config PASSED
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_short_run WARNING: deep-sort-realtime not installed. Falling back to simple IoU-based tracking.
python : 
At line:1 char:1
+ python -m pytest te
sts/test_pipeline_vid
eo.py -v --tb=short 
-s 2>&1 | ...
+ ~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~
~~~~~~~~~~~~~~~~~~~~~
~~~~~~
    + CategoryInfo   
           : NotSpe  
  cified: (:String   
 ) [], RemoteExce    
ption
    + FullyQualified 
   ErrorId : Native  
  CommandError
 
Processing video:   
0%|          | 0/30 
[00:00<?, ?it/s]
Processing video:   
3%|3         | 1/30 
[00:02<01:01,  
2.13s/it]
Processing video:   
7%|6         | 2/30 
[00:02<00:28,  
1.02s/it]
Processing video:  
10%|#         | 3/30 
[00:02<00:17,  
1.50it/s]
Processing video:  
13%|#3        | 4/30 
[00:02<00:13,  
1.94it/s]
Processing video:  
17%|#6        | 5/30 
[00:03<00:11,  
2.27it/s]
Processing video:  
20%|##        | 6/30 
[00:03<00:08,  
2.73it/s]
Processing video:  
23%|##3       | 7/30 
[00:03<00:07,  
3.03it/s]
Processing video:  
27%|##6       | 8/30 
[00:03<00:06,  
3.19it/s]
Processing video:  
30%|###       | 9/30 
[00:04<00:06,  
3.44it/s]
Processing video:  
33%|###3      | 
10/30 [00:04<00:05,  
3.66it/s]
Processing video:  
37%|###6      | 
11/30 [00:04<00:05,  
3.70it/s]
Processing video:  
40%|####      | 
12/30 [00:04<00:04,  
3.69it/s]
Processing video:  
43%|####3     | 
13/30 [00:05<00:04,  
3.77it/s]
Processing video:  
47%|####6     | 
14/30 [00:05<00:04,  
3.98it/s]
Processing video:  
50%|#####     | 
15/30 [00:05<00:03,  
3.78it/s]
Processing video:  
53%|#####3    | 
16/30 [00:05<00:03,  
3.91it/s]
Processing video:  
57%|#####6    | 
17/30 [00:06<00:03,  
3.93it/s]
Processing video:  
60%|######    | 
18/30 [00:06<00:02,  
4.04it/s]
Processing video:  
63%|######3   | 
19/30 [00:06<00:02,  
4.02it/s]
Processing video:  
67%|######6   | 
20/30 [00:06<00:02,  
4.15it/s]
Processing video:  
70%|#######   | 
21/30 [00:07<00:02,  
4.24it/s]
Processing video:  
73%|#######3  | 
22/30 [00:07<00:02,  
3.98it/s]
Processing video:  
77%|#######6  | 
23/30 [00:07<00:01,  
4.07it/s]
Processing video:  
80%|########  | 
24/30 [00:07<00:01,  
4.13it/s]
Processing video:  
83%|########3 | 
25/30 [00:08<00:01,  
3.99it/s]
Processing video:  
87%|########6 | 
26/30 [00:08<00:00,  
4.12it/s]
Processing video:  
90%|######### | 
27/30 [00:08<00:00,  
4.12it/s]
Processing video:  
93%|#########3| 
28/30 [00:08<00:00,  
4.23it/s]
Processing video:  
97%|#########6| 
29/30 [00:09<00:00,  
4.33it/s]
Processing video: 
100%|##########| 
30/30 [00:09<00:00,  
4.34it/s]
Processing video: 
100%|##########| 
30/30 [00:09<00:00,  
3.22it/s]

  Pipeline completed in 9.6s
  Output: D:\Downloads\cv\tennis-pickleball-tracker\outputs\test_results\test_pipeline_30frames.mp4 (0.3 KB)
  NOTE: Output video file exists but could not be opened (codec flush issue for short runs, file=258B)
  Stats: {'total_frames': 30, 'fps': 30.0, 'resolution': (1920, 1080), 'ball_detections': 30, 'player_detections': 0, 'bounces': [{'frame': 13, 'x': np.float64(-3.502043059837328e-06), 'y': np.float64(10.970000932910127), 'is_in': np.False_, 'confidence': 1.0}], 'processing_time': 9.324883937835693, 'processing_fps': 3.2171982193016984, 'analysis_summary': {'total_bounces': 1, 'in_count': 0, 'out_count': 1, 'trajectory_length': 29}}
PASSED
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_100_frames WARNING: deep-sort-realtime not installed. Falling back to simple IoU-based tracking.

Processing video:   
0%|          | 0/100 
[00:00<?, ?it/s]
Processing video:   
1%|1         | 1/100 
[00:02<03:23,  
2.06s/it]
Processing video:   
2%|2         | 2/100 
[00:02<01:38,  
1.00s/it]
Processing video:   
3%|3         | 3/100 
[00:02<01:04,  
1.51it/s]
Processing video:   
4%|4         | 4/100 
[00:02<00:47,  
2.03it/s]
Processing video:   
5%|5         | 5/100 
[00:03<00:38,  
2.49it/s]
Processing video:   
6%|6         | 6/100 
[00:03<00:32,  
2.87it/s]
Processing video:   
7%|7         | 7/100 
[00:03<00:29,  
3.18it/s]
Processing video:   
8%|8         | 8/100 
[00:03<00:26,  
3.42it/s]
Processing video:   
9%|9         | 9/100 
[00:04<00:26,  
3.46it/s]
Processing video:  
10%|#         | 
10/100 [00:04<00:25, 
 3.59it/s]
Processing video:  
11%|#1        | 
11/100 [00:04<00:24, 
 3.66it/s]
Processing video:  
12%|#2        | 
12/100 [00:04<00:23, 
 3.75it/s]
Processing video:  
13%|#3        | 
13/100 [00:05<00:22, 
 3.85it/s]
Processing video:  
14%|#4        | 
14/100 [00:05<00:22, 
 3.88it/s]
Processing video:  
15%|#5        | 
15/100 [00:05<00:22, 
 3.78it/s]
Processing video:  
16%|#6        | 
16/100 [00:05<00:22, 
 3.75it/s]
Processing video:  
17%|#7        | 
17/100 [00:06<00:22, 
 3.72it/s]
Processing video:  
18%|#8        | 
18/100 [00:06<00:22, 
 3.68it/s]
Processing video:  
19%|#9        | 
19/100 [00:06<00:22, 
 3.61it/s]
Processing video:  
20%|##        | 
20/100 [00:06<00:21, 
 3.67it/s]
Processing video:  
21%|##1       | 
21/100 [00:07<00:21, 
 3.75it/s]
Processing video:  
22%|##2       | 
22/100 [00:07<00:19, 
 4.03it/s]
Processing video:  
23%|##3       | 
23/100 [00:07<00:18, 
 4.17it/s]
Processing video:  
24%|##4       | 
24/100 [00:07<00:18, 
 4.03it/s]
Processing video:  
25%|##5       | 
25/100 [00:08<00:18, 
 4.14it/s]
Processing video:  
26%|##6       | 
26/100 [00:08<00:17, 
 4.18it/s]
Processing video:  
27%|##7       | 
27/100 [00:08<00:16, 
 4.34it/s]
Processing video:  
28%|##8       | 
28/100 [00:08<00:16, 
 4.31it/s]
Processing video:  
29%|##9       | 
29/100 [00:09<00:16, 
 4.27it/s]
Processing video:  
30%|###       | 
30/100 [00:09<00:16, 
 4.25it/s]
Processing video:  
31%|###1      | 
31/100 [00:09<00:17, 
 3.89it/s]
Processing video:  
32%|###2      | 
32/100 [00:09<00:17, 
 3.88it/s]
Processing video:  
33%|###3      | 
33/100 [00:10<00:16, 
 3.95it/s]
Processing video:  
34%|###4      | 
34/100 [00:10<00:15, 
 4.16it/s]
Processing video:  
35%|###5      | 
35/100 [00:10<00:15, 
 4.24it/s]
Processing video:  
36%|###6      | 
36/100 [00:10<00:14, 
 4.30it/s]
Processing video:  
37%|###7      | 
37/100 [00:11<00:15, 
 4.14it/s]
Processing video:  
38%|###8      | 
38/100 [00:11<00:14, 
 4.22it/s]
Processing video:  
39%|###9      | 
39/100 [00:11<00:14, 
 4.23it/s]
Processing video:  
40%|####      | 
40/100 [00:11<00:14, 
 4.17it/s]
Processing video:  
41%|####1     | 
41/100 [00:12<00:14, 
 4.03it/s]
Processing video:  
42%|####2     | 
42/100 [00:12<00:14, 
 4.14it/s]
Processing video:  
43%|####3     | 
43/100 [00:12<00:13, 
 4.30it/s]
Processing video:  
44%|####4     | 
44/100 [00:12<00:12, 
 4.51it/s]
Processing video:  
45%|####5     | 
45/100 [00:12<00:11, 
 4.60it/s]
Processing video:  
46%|####6     | 
46/100 [00:13<00:11, 
 4.66it/s]
Processing video:  
47%|####6     | 
47/100 [00:13<00:11, 
 4.61it/s]
Processing video:  
48%|####8     | 
48/100 [00:13<00:11, 
 4.47it/s]
Processing video:  
49%|####9     | 
49/100 [00:13<00:11, 
 4.46it/s]
Processing video:  
50%|#####     | 
50/100 [00:14<00:11, 
 4.35it/s]
Processing video:  
51%|#####1    | 
51/100 [00:14<00:11, 
 4.35it/s]
Processing video:  
52%|#####2    | 
52/100 [00:14<00:11, 
 4.20it/s]
Processing video:  
53%|#####3    | 
53/100 [00:14<00:11, 
 4.10it/s]
Processing video:  
54%|#####4    | 
54/100 [00:14<00:11, 
 4.14it/s]
Processing video:  
55%|#####5    | 
55/100 [00:15<00:10, 
 4.10it/s]
Processing video:  
56%|#####6    | 
56/100 [00:15<00:10, 
 4.11it/s]
Processing video:  
57%|#####6    | 
57/100 [00:15<00:10, 
 4.03it/s]
Processing video:  
58%|#####8    | 
58/100 [00:15<00:10, 
 4.11it/s]
Processing video:  
59%|#####8    | 
59/100 [00:16<00:09, 
 4.28it/s]
Processing video:  
60%|######    | 
60/100 [00:16<00:09, 
 4.30it/s]
Processing video:  
61%|######1   | 
61/100 [00:16<00:09, 
 4.11it/s]
Processing video:  
62%|######2   | 
62/100 [00:16<00:09, 
 4.06it/s]
Processing video:  
63%|######3   | 
63/100 [00:17<00:09, 
 3.88it/s]
Processing video:  
64%|######4   | 
64/100 [00:17<00:08, 
 4.04it/s]
Processing video:  
65%|######5   | 
65/100 [00:17<00:08, 
 4.05it/s]
Processing video:  
66%|######6   | 
66/100 [00:17<00:08, 
 3.99it/s]
Processing video:  
67%|######7   | 
67/100 [00:18<00:08, 
 3.86it/s]
Processing video:  
68%|######8   | 
68/100 [00:18<00:08, 
 3.95it/s]
Processing video:  
69%|######9   | 
69/100 [00:18<00:07, 
 3.92it/s]
Processing video:  
70%|#######   | 
70/100 [00:18<00:07, 
 3.91it/s]
Processing video:  
71%|#######1  | 
71/100 [00:19<00:07, 
 3.77it/s]
Processing video:  
72%|#######2  | 
72/100 [00:19<00:07, 
 3.92it/s]
Processing video:  
73%|#######3  | 
73/100 [00:19<00:06, 
 3.90it/s]
Processing video:  
74%|#######4  | 
74/100 [00:20<00:06, 
 3.94it/s]
Processing video:  
75%|#######5  | 
75/100 [00:20<00:06, 
 3.86it/s]
Processing video:  
76%|#######6  | 
76/100 [00:20<00:06, 
 3.81it/s]
Processing video:  
77%|#######7  | 
77/100 [00:20<00:05, 
 3.85it/s]
Processing video:  
78%|#######8  | 
78/100 [00:21<00:05, 
 3.96it/s]
Processing video:  
79%|#######9  | 
79/100 [00:21<00:05, 
 3.86it/s]
Processing video:  
80%|########  | 
80/100 [00:21<00:04, 
 4.14it/s]
Processing video:  
81%|########1 | 
81/100 [00:21<00:04, 
 4.00it/s]
Processing video:  
82%|########2 | 
82/100 [00:22<00:04, 
 3.83it/s]
Processing video:  
83%|########2 | 
83/100 [00:22<00:04, 
 3.81it/s]
Processing video:  
84%|########4 | 
84/100 [00:22<00:04, 
 3.70it/s]
Processing video:  
85%|########5 | 
85/100 [00:22<00:04, 
 3.65it/s]
Processing video:  
86%|########6 | 
86/100 [00:23<00:03, 
 3.72it/s]
Processing video:  
87%|########7 | 
87/100 [00:23<00:03, 
 3.62it/s]
Processing video:  
88%|########8 | 
88/100 [00:23<00:03, 
 3.66it/s]
Processing video:  
89%|########9 | 
89/100 [00:24<00:03, 
 3.63it/s]
Processing video:  
90%|######### | 
90/100 [00:24<00:02, 
 3.73it/s]
Processing video:  
91%|#########1| 
91/100 [00:24<00:02, 
 3.58it/s]
Processing video:  
92%|#########2| 
92/100 [00:24<00:02, 
 3.65it/s]
Processing video:  
93%|#########3| 
93/100 [00:25<00:01, 
 3.74it/s]
Processing video:  
94%|#########3| 
94/100 [00:25<00:01, 
 3.81it/s]
Processing video:  
95%|#########5| 
95/100 [00:25<00:01, 
 3.73it/s]
Processing video:  
96%|#########6| 
96/100 [00:25<00:01, 
 3.71it/s]
Processing video:  
97%|#########7| 
97/100 [00:26<00:00, 
 3.83it/s]
Processing video:  
98%|#########8| 
98/100 [00:26<00:00, 
 3.86it/s]
Processing video:  
99%|#########9| 
99/100 [00:26<00:00, 
 3.86it/s]
Processing video: 
100%|##########| 
100/100 
[00:26<00:00,  
4.01it/s]
Processing video: 
100%|##########| 
100/100 
[00:26<00:00,  
3.72it/s]

  100-frame pipeline: 27.1s (3.7 fps)
  Stats: {'total_frames': 100, 'fps': 30.0, 'resolution': (1920, 1080), 'ball_detections': 100, 'player_detections': 0, 'bounces': [{'frame': 13, 'x': np.float64(-3.502043059837328e-06), 'y': np.float64(10.970000932910127), 'is_in': np.False_, 'confidence': 1.0}, {'frame': 35, 'x': np.float64(-3.5288440587981006e-06), 'y': np.float64(10.970000917108214), 'is_in': np.False_, 'confidence': 1.0}, {'frame': 53, 'x': np.float64(-3.5439851757221388e-06), 'y': np.float64(10.970000924129165), 'is_in': np.False_, 'confidence': 1.0}, {'frame': 68, 'x': np.float64(-3.854968284987809e-06), 'y': np.float64(10.970000948326726), 'is_in': np.False_, 'confidence': 1.0}, {'frame': 80, 'x': np.float64(-4.745101370987659e-06), 'y': np.float64(10.970001109317352), 'is_in': np.False_, 'confidence': 1.0}, {'frame': 90, 'x': np.float64(-3.5058680823119536e-05), 'y': np.float64(10.970005985634389), 'is_in': np.False_, 'confidence': 1.0}], 'processing_time': 26.864888906478882, 'processing_fps': 3.722330672876278, 'analysis_summary': {'total_bounces': 6, 'in_count': 0, 'out_count': 6, 'trajectory_length': 99}}
PASSED
tests/test_pipeline_video.py::TestIntegration::test_court_detection_to_classification PASSED
tests/test_pipeline_video.py::TestIntegration::test_detection_to_tracking 
  Ball tracked at (361.0, 941.5)
PASSED
tests/test_pipeline_video.py::TestIntegration::test_visualization_with_real_detections 
  Saved annotated frame: D:\Downloads\cv\tennis-pickleball-tracker\outputs\test_results\annotated_frame.jpg
PASSED

============================== warnings summary ===============================
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
  C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\thop\profile.py:12: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(torch.__version__) < LooseVersion("1.0.0"):

tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
  C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\thop\profile.py:68: DeprecationWarning: distutils Version classes are deprecated. Use packaging.version instead.
    if LooseVersion(torch.__version__) >= LooseVersion("1.1.0"):

tests/test_pipeline_video.py::TestObjectDetection::test_yolo_init
tests/test_pipeline_video.py::TestObjectDetection::test_yolo_detect_on_frame
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_short_run
tests/test_pipeline_video.py::TestEndToEndPipeline::test_pipeline_100_frames
tests/test_pipeline_video.py::TestIntegration::test_detection_to_tracking
tests/test_pipeline_video.py::TestIntegration::test_visualization_with_real_detections
  C:\Users\GIGABYTE\AppData\Roaming\Python\Python313\site-packages\ultralytics\nn\tasks.py:567: UserWarning: Environment variable TORCH_FORCE_NO_WEIGHTS_ONLY_LOAD detected, since the`weights_only` argument was not explicitly passed to `torch.load`, forcing weights_only=False.
    return torch.load(file, map_location='cpu'), file  # load

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
====================== 56 passed, 10 warnings in 52.73s =======================
